function validateAdmission(){
	 var result = null;
	 var admissionNo = $('#student_admission_no').val();
     var target = "admission_no"  + '?id='  + admissionNo
     $.ajax({
        url: target,
        type: 'get',
        async: false,
        success: function(data) {
            result = (data.valid);
        } 
     });
     	if(result == true) {
			$('#outer_block').removeBlockMessages().blockMessage('Admission No has already been taken', {
						type : 'warning'
					});
	  	}else if(result == false){
	  		$('#outer_block').removeBlockMessages();
	  	}   
        return result;
}

function picncodeCheck(){
	var pinCode = null;
	   $(".pincode").each(function() {
		   if ($(this).val().length < 6 || $(this).val().length > 6) {
		       	pinCode = false;			
		   }
	  });
	  return pinCode;
}
function phoneValidation(){
	var phone_validation = null;
	   $(".phone").each(function() {
	   	if ($(this).val()!=0){
		   if ($(this).val().length < 7 || $(this).val().length > 11) {
		       	phone_validation = false;			
		   }
		 }
	  });
	  return phone_validation;
}

function mobileValidation(){
	var mobile_validation = null;
	   $(".mobile").each(function() {
	   	if ($(this).val()!=0){
		   if ($(this).val().length < 10 || $(this).val().length > 12) {
		       	mobile_validation = false;			
		   }
		 }
	  });
	  return mobile_validation;
}


function characterLength(){
	var classfield = null; 
	    $(".full-width").each(function() {
			if ($(this).val().length >= 50){
				classfield = false;
			}
		}); 
		return classfield;
}
function parentCharacterLength(){
	var classfield = null; 
	    $(".parent_Class").each(function() {
			if ($(this).val().length >= 50){
				classfield = false;
			}
		}); 
		return classfield;
}

function isSpclChar(){
   var special_character = null;
   var iChars = "!$%^&*()+=[];{}:<>?";  
   $(".full-width").each(function() {
   	 for (var i = 0; i < $(this).val().length; i++) {
                if (iChars.indexOf($(this).val().charAt(i)) != -1) {
                special_character = false;
        		}
      }
  	});
  
   return special_character;
}

function isParentSpclChar(){
   var special_Character = null;
    var iChars = "!$%^&*()+=[];{}:<>?"; 
   $(".parent_Class").each(function() {
   	 for (var i = 0; i < $(this).val().length; i++) {
                if (iChars.indexOf($(this).val().charAt(i)) != -1) {
                special_Character = false;
        		}
      }
  	});
   return special_Character;
}

function numericTest(){
	var number = null;
	 $(".numeric").each(function() {	 	
	 	 if($(this).val()!= 0){
	  			if (isNaN($(this).val()) || $(this).val().indexOf(" ")!= -1 ) {
	  				number = false;
	            }
	        }
	 });
	 return number;
}

	$('#next_button').on('click', function(event) {
	    var status = validateAdmission(); 
	    var special_character = isSpclChar();
		var characterCheck = characterLength();
		var student_step = $('#student_step').val();
		var firstname = $('#student_first_name').val();
		var lastname = $('#student_last_name').val();
		var middlename = $('#student_middle_name').val();
		var admissiondate = $('#student_admission_date').val();
		var admissionNo = $('#student_admission_no').val();
		var dateofbirth = $('#student_date_of_birth').val();
		var batch_id = $('#student_batch_id').val();
	if(student_step == "personal"){
			if(!firstname || firstname.length == 0) {
				$('#outer_block').removeBlockMessages().blockMessage('Please enter First name', {
					type : 'warning'
				});
				return false;
			}else if(!lastname || lastname.length == 0) {
				$('#outer_block').removeBlockMessages().blockMessage('Please enter Last Name', {
					type : 'warning'
				});
				return false;
			} else if(!admissiondate || admissiondate.length == 0) {
				$('#outer_block').removeBlockMessages().blockMessage('Please enter Admission date', {
					type : 'warning'
				});
				return false;
			} else if(!batch_id || batch_id.length == 0) {
				$('#outer_block').removeBlockMessages().blockMessage('Please Select Batch', {
					type : 'warning'
				});
				return false;
			}else if(!admissionNo || admissionNo.length == 0) {
				$('#outer_block').removeBlockMessages().blockMessage('Please enter Admission N0', {
					type : 'warning'
				});
				return false;
			}else if(!dateofbirth || dateofbirth.length == 0) {
				$('#outer_block').removeBlockMessages().blockMessage('Please enter Date of Birth', {
					type : 'warning'
				});
				return false;
			}else if(status == true){
					$('#outer_block').removeBlockMessages().blockMessage('Admission No has already been taken', {
					type : 'warning'
				});
		  		return false;
			}else if(characterCheck == false){
					$('#outer_block').removeBlockMessages().blockMessage('You can not enter more than 50 character in field', {
					type : 'warning'
				});
		  		return false;
			}else if(special_character == false){
					$('#outer_block').removeBlockMessages().blockMessage("The text field has special characters. \nThese are not allowed.\n", {
					type : 'warning'
				});
		  		return false;
			}else{
					return true;
			}			
		} 

	});


	$('#wizard_next_button').on('click', function(event) {
		var student_step = $('#student_step').val();
		if(student_step == "image") {
		var imgpath = document.getElementById('upload_image').value;
		var checkimg = imgpath.toLowerCase();
		if (!checkimg.length == 0){
			if (!checkimg.match(/(\.jpg|\.gif|\.png|\.JPG|\.GIF|\.PNG|\.jpeg|\.JPEG)$/)  )
			{
			event.preventDefault();
			  $('#outer_block').removeBlockMessages().blockMessage('Image Extension must be one of [.gif  or .jpg or .jpeg or .png]', {
					type : 'warning'
				});
			}else{
			    return true;
			}
         }
        }else if(student_step == "address"){
            var pincode = picncodeCheck();
		    var phone_check = phoneValidation();
        	var characterCheck = characterLength();
        	var special_character = isSpclChar();
        	var student_mobile = $('#student_phone2').val();
        	var student_phone = $('#student_phone1').val();
        	var student_pinCode = $('#student_pin_code').val();
        	var student_email = $('#student_email').val();
            if(student_mobile!= 0){
	  			if (isNaN(student_mobile) || student_mobile.indexOf(" ")!= -1 ) {
	  				$('#outer_block').removeBlockMessages().blockMessage('Please Enter Valid Mobile', {
						type : 'warning'
					});
	  				return false;
	            }else if (student_mobile.length > 10){
	  				$('#outer_block').removeBlockMessages().blockMessage('Please Enter 10 Character', {
						type : 'warning'
					});
	  				return false;
	            }else if (student_mobile.length < 10){
	  				$('#outer_block').removeBlockMessages().blockMessage('Please Enter 10 Character', {
						type : 'warning'
					});
	  				return false;
	            }
            }
            if(characterCheck == false){
					$('#outer_block').removeBlockMessages().blockMessage('You can not enter more than 50 character in field', {
					type : 'warning'
				});
		  		return false;
			}
			if(student_pinCode!= 0){
				if(pincode == false){
						$('#outer_block').removeBlockMessages().blockMessage('Please Enter Valid 6 Digit PinCode', {
						type : 'warning'
					});
			  		return false;
				}
			}
			if(student_phone!= 0){
					if(phone_check == false){
							$('#outer_block').removeBlockMessages().blockMessage('Phone Number must be  7  - 11 Digit long', {
							type : 'warning'
						});
				  		return false;
					}
			}
			if(special_character == false){
					$('#outer_block').removeBlockMessages().blockMessage("The text field has special characters. \nThese are not allowed.\n", {
					type : 'warning'
				});
		  		return false;
			}
            if(student_phone!= 0){
	  			if (isNaN(student_phone) || student_phone.indexOf(" ")!= -1 ) {
	  				$('#outer_block').removeBlockMessages().blockMessage('Please Enter Valid Phone Number', {
						type : 'warning'
					});
	  				return false;
	            }
            }
            if(student_pinCode!= 0){
	  			if (isNaN(student_pinCode) || student_pinCode.indexOf(" ")!= -1 ) {
	  				$('#outer_block').removeBlockMessages().blockMessage('Please Enter Valid Pin Code', {
						type : 'warning'
					});
	  				return false;
	            }
            }
            if(student_email!= 0){
				var atpos=student_email.indexOf("@");
				var dotpos=student_email.lastIndexOf(".");
				if (atpos<1 || dotpos<atpos+2 || dotpos+2>=student_email.length)
				  {
				  	$('#outer_block').removeBlockMessages().blockMessage('Not a valid e-mail address', {
						type : 'warning'
					});
				  return false;
				  }     
            }
            
   		}
	});


$(document).ready(function() {
	$('#cropsbox').Jcrop({
		onChange : update_crop,
		onSelect : update_crop,
		setSelect : [0, 0, 100, 100],
		aspectRatio : 1
	});
});
function update_crop(coords) {
	var rx = 100 / coords.w;
	var ry = 100 / coords.h;
	var pw = document.getElementById("photo_width").value;
	var pwl = document.getElementById("photo_width_large").value;
	var phl = document.getElementById("photo_height_large").value;
	$('#preview').css({
		width : Math.round(rx * pwl) + 'px',
		height : Math.round(ry * phl) + 'px',
		marginLeft : '-' + Math.round(rx * coords.x) + 'px',
		marginTop : '-' + Math.round(ry * coords.y) + 'px'
	});
	var ratio = pw / pwl;
	$("#crop_x").val(Math.round(coords.x * ratio));
	$("#crop_y").val(Math.round(coords.y * ratio));
	$("#crop_w").val(Math.round(coords.w * ratio));
	$("#crop_h").val(Math.round(coords.h * ratio));
}

$(document).ready(function(){
	

	$('#save_guardian').on('click', function(event) {
		// event.preventDefault();
		// var phone_check = phoneValidation();
		var charactercheck = parentCharacterLength();
		var special_Character = isParentSpclChar();
		var guardian_last_name = document.getElementById("guardian_last_name").value;
		var guardian_name = document.getElementById("guardian_first_name").value;
		var guardian_relation = document.getElementById("guardian_relation").value;
		var guardian_dob = document.getElementById("guardian_dob").value;
		var guardian_education = document.getElementById("guardian_education").value;
		var guardian_occupation = document.getElementById("guardian_occupation").value;
		var studentId = document.getElementById('studentID').value;
		var parent_income = document.getElementById('income').value;
		var parent_email = document.getElementById('parent_email').value;
		var parent_office1 = document.getElementById('office_phone1').value;
		var parent_office2 = document.getElementById('office_phone2').value;
		var parent_mobile = document.getElementById('mobile_phone').value;
		var add1 = document.getElementById('guardian_address1').value;
		var add2 = document.getElementById('guardian_address2').value;
		var city = document.getElementById('guardian_city').value;
		var state = document.getElementById('guardian_state').value;
		var country = document.getElementById('guardian_country_id').value;
		
		var data = {
			'guardian[ward_id]' : studentId,
				'guardian[first_name]' : firstname,
				'guardian[last_name]' : lastname,
				'guardian[relation]' : batch,
				'guardian[email]' : category,
				'guardian[office_phone1]' : status,
				'guardian[office_phone2]' : bloodgroup,
				'guardian[mobile_phone]' : dob,
				'guardian[office_address_line1]' : religion,
				'guardian[office_address_line2]' : lastname,
				'guardian[city]' : batch,
				'guardian[state]' : category,
				'guardian[country_id]' : status,
				'guardian[dob]' : bloodgroup,
				'guardian[occupation]' : dob,
				'guardian[income]' : religion,
				'guardian[education]' : nationalityid,
				'_method' : 'put'
		}
		   if(parent_office1!= 0){
		   	var phone_check = phoneValidation();
					if(phone_check == false){
							$('#outer_block').removeBlockMessages().blockMessage('Phone Number must be  7  - 11 Digit long', {
							type : 'warning'
						});
				  		return false;
					}
			}
			if(parent_office2!= 0){
				var phone_check = phoneValidation();
					if(phone_check == false){
							$('#outer_block').removeBlockMessages().blockMessage('Phone Number must be  7  - 11 Digit long', {
							type : 'warning'
						});
				  		return false;
					}
			}		
			if(!guardian_name || guardian_name.length == 0) {
				$('#outer_block').removeBlockMessages().blockMessage('Please enter First name', {
					type : 'warning'
				});
				return false;
			}
			if(parent_income!= 0){
	  			if (isNaN(parent_income) || parent_income.indexOf(" ")!= -1 ) {
	  				$('#outer_block').removeBlockMessages().blockMessage('Please Enter Valid Income', {
						type : 'warning'
					});
	  				return false;
	            }
            }
            if(parent_email!= 0){
	  			var atpos=parent_email.indexOf("@");
				var dotpos=parent_email.lastIndexOf(".");
				if (atpos<1 || dotpos<atpos+2 || dotpos+2>=parent_email.length){
				  	$('#outer_block').removeBlockMessages().blockMessage('Not a valid e-mail address', {
						type : 'warning'
					});
				  return false;
				  }  
            }
            if(parent_mobile!= 0){
			  			if (isNaN(parent_mobile) || parent_mobile.indexOf(" ")!= -1 ) {
			  				$('#outer_block').removeBlockMessages().blockMessage('Please Enter Valid Mobile', {
								type : 'warning'
							});
			  				return false;
			            }else if (parent_mobile.length > 10){
			  				$('#outer_block').removeBlockMessages().blockMessage('Please Enter 10 Character', {
								type : 'warning'
							});
			  				return false;
			            }else if (parent_mobile.length < 10){
			  				$('#outer_block').removeBlockMessages().blockMessage('Please Enter 10 Character', {
								type : 'warning'
							});
			  				return false;
				            }
	         }
	         if(parent_office1!= 0){
		  			if (isNaN(parent_office1) || parent_office1.indexOf(" ")!= -1 ) {
		  				$('#outer_block').removeBlockMessages().blockMessage('Please Enter Valid Phone Number', {
							type : 'warning'
						});
		  				return false;
		            }
	          }
	          if(parent_office2!= 0){
		  			if (isNaN(parent_office2) || parent_office2.indexOf(" ")!= -1 ) {
		  				$('#outer_block').removeBlockMessages().blockMessage('Please Enter Valid Phone Number', {
							type : 'warning'
						});
		  				return false;
		            }
	          }
	          if(charactercheck == false){
						$('#outer_block').removeBlockMessages().blockMessage('You can not enter more than 50 character in field', {
						type : 'warning'
					});
			  		return false;
		      }
		      if(special_Character == false){
						$('#outer_block').removeBlockMessages().blockMessage("The text field has special characters. \nThese are not allowed.\n", {
						type : 'warning'
					});
			  		return false;
			  } 	
				    var href = "save"  + '?q='  +  studentId
					$.get(href, function(data) {
					});
					var prev_location = window.opener;
					window.close();
					prev_location.location = href
			   
					
	});

});

	$('#update_student').on('click', function(event) {
		var length_check = characterLength();
		var special_character = isSpclChar();
		var firstname = $('#student_first_name').val();
		var student_id = $('#current_student').val();
		var lastname = $('#student_last_name').val();
		var batch = $('#student_batch_id').val();
		var dob = $('#student_date_of_birth').val();
		var category = $('#student_student_category_id').val();
		var status = $("input[name='student\\[gender\\]']:checked").val();
		var bloodgroup = $('#student_blood_group').val();
		var religion = $('#student_religion').val();
		var nationalityid = $('#student_nationality_id').val();
		if(special_character == false){
						$('#outer_block').removeBlockMessages().blockMessage("The text field has special characters. \nThese are not allowed.\n", {
						type : 'warning'
					});
			  		return false;
		}
	    if(length_check == false){
					$('#outer_block').removeBlockMessages().blockMessage('You can not enter more than 50 character in field', {
						type : 'warning'
					});
					return false;
		}
		if(!firstname || firstname.length == 0) {
			$('#outer_block').removeBlockMessages().blockMessage('Please enter First name', {
				type : 'warning'
			});
			return false;
		} else if(!lastname || lastname.length == 0) {
			$('#outer_block').removeBlockMessages().blockMessage('Please enter Last Name', {
				type : 'warning'
			});
			return false;
		} else {
			var target = 'update_student' + '?id='  +  student_id
			// Request
			var data = {
				'student[first_name]' : firstname,
				'student[last_name]' : lastname,
				'student[batch_id]' : batch,
				'student[student_category_id]' : category,
				'student[gender]' : status,
				'student[blood_group]' : bloodgroup,
				'student[date_of_birth]' : dob,
				'student[religion]' : religion,
				'student[nationality_id]' : nationalityid,
				'_method' : 'put'
			}
			$.ajax({
				url : target,
				dataType : 'json',
				data : data,
				success : function(data) {
					if(data.valid) {
						$('#outer_block').removeBlockMessages().blockMessage(data.notice, {
							type : 'success'
						});
					} else {
						var errorText = getErrorText(data.errors);
						$('#outer_block').removeBlockMessages().blockMessage(errorText || 'An unexpected error occured, please try again', {
							type : 'error'
						});
					}
				},
				error : function(data) {
					$('#outer_block').removeBlockMessages().blockMessage('Error while contacting server, please try again', {
						type : 'error'
					});
				}
			});
		}
	});



	$('#update_contact').on('click', function(event) {
		var pincode = picncodeCheck();
		var phone_check = phoneValidation();
		var address1 = $('#student_address_line1').val();
		var student_id = $('#current_student').val();
		var address2 = $('#student_address_line2').val();
		var city = $('#student_city').val();
		var state = $('#student_state').val();
		var pinCode = $('#student_pin_code').val();
		var phone1 = $('#student_phone1').val();
		var phone2 = $('#student_phone2').val();
		var email = $('#student_email').val();
		var numericity_check = numericTest();
		var length_check = characterLength();
		var special_character = isSpclChar();
			var target = 'update_student' + '?id='  +  student_id
			// Request
			var data = {
				'student[address_line1]' : address1,
				'student[address_line2]' : address2,
				'student[city]' : city,
				'student[state]' : state,
				'student[pin_code]' : pinCode,
				'student[phone1]' : phone1,
				'student[phone2]' : phone2,
				'student[email]' : email,
		         '_method' : 'put'
			}
			 if(email!= 0){
	  			var atpos=email.indexOf("@");
				var dotpos=email.lastIndexOf(".");
				if (atpos<1 || dotpos<atpos+2 || dotpos+2>=email.length){
				  	$('#outer_block').removeBlockMessages().blockMessage('Not a valid e-mail address', {
						type : 'warning'
					});
				  return false;
				  }  
            }
            if(special_character == false){
						$('#outer_block').removeBlockMessages().blockMessage("The text field has special characters. \nThese are not allowed.\n", {
						type : 'warning'
					});
			  		return false;
			}
			if(phone_check == false){
						$('#outer_block').removeBlockMessages().blockMessage("Phone Number must be  7  - 11 Digit long", {
						type : 'warning'
					});
			  		return false;
			}
			 if(pincode == false){
						$('#outer_block').removeBlockMessages().blockMessage("Please Enter Valid 6 Digit PinCode", {
						type : 'warning'
					});
			  		return false;
			}
	        if(numericity_check==false){
	      	$('#outer_block').removeBlockMessages().blockMessage('Please Enter Numeric value', {
						type : 'warning'
					});
					return false;
	        }
	        if(length_check == false){
					$('#outer_block').removeBlockMessages().blockMessage('You can not enter more than 50 character in field', {
						type : 'warning'
					});
					return false;
		    }
			$.ajax({
				url : target,
				dataType : 'json',
				data : data,
				success : function(data) {
					if(data.valid) {
						$('#outer_block').removeBlockMessages().blockMessage(data.notice, {
							type : 'success'
							
						});
						
					} else {
						var errorText = getErrorText(data.errors);
						$('#outer_block').removeBlockMessages().blockMessage(errorText || 'An unexpected error occured, please try again', {
							type : 'error'
						});
						
					}
				},
				error : function(data) {
					$('#outer_block').removeBlockMessages().blockMessage('Error while contacting server, please try again', {
						type : 'error'
					});
				}
			});
	
	});



$(document).on("click", "#update_parent_office", function(event){
	var currentTab = $("#tab-global .current").attr("id");
	event.preventDefault();
	var guardian_email = $('#parent_email'+currentTab).val();
	var ward_id = $('#current_student').val();
	var guardian_office_address1 = $('#parent_address'+currentTab).val();
    var guardian_office_address2 = $('#parent_2address'+currentTab).val();
	var guardian_city = $('#parent_city'+currentTab).val();
	var guardian_state= $('#parent_state'+currentTab).val();
    var data = {
				'guardian[email]' : guardian_email,
				'guardian[office_address_line1]' : guardian_office_address1,
				'guardian[office_address_line2]' : guardian_office_address2,
				'guardian[city]' : guardian_city,
				'guardian[state]' : guardian_state,
				'guardian[ward_id]' : ward_id,			  
				'parent_id' : currentTab,
				 '_method' : 'put'
	      }
	      if(guardian_email!= 0){
	  			var atpos=guardian_email.indexOf("@");
				var dotpos=guardian_email.lastIndexOf(".");
				if (atpos<1 || dotpos<atpos+2 || dotpos+2>=guardian_email.length)
				  {
				  	$('#outer_block').removeBlockMessages().blockMessage('Not a valid e-mail address', {
						type : 'warning'
					});
				  return false;
				  }   
            } 
			  var url=  "update_guardian"+ '?id='  +  ward_id
			    $.ajax({
						url : url,
						dataType : 'json',
						data : data,
						success : function(data) {
							
							if(data.valid) {
								$('#outer_block').removeBlockMessages().blockMessage(data.notice, {
									type : 'success'
								});
							} else {
								var errorText = getErrorText(data.errors);
								$('#outer_block').removeBlockMessages().blockMessage(errorText || 'An unexpected error occured, please try again', {
									type : 'error'
								});
							}
						},
						error : function(data) {
							$('#outer_block').removeBlockMessages().blockMessage('Error while contacting server, please try again', {
								type : 'error'
							});
						}
					});
			// }   
});

$(document).on("click", "#delete_parent", function(event) {
	var currentTab = $("#tab-global .current").attr("id");
	var target = "del_guardian" + "?id=" + currentTab
	var ward_id = $('#current_student').val();
	$.modal({
				content: '<h3>Are you sure?</h3><br/><br/><p>You are about to delete a Guardian...</p>',
				title: 'Delete Guardian?',
				maxWidth: 500,
				buttons: {
					'Ok': function(win) {
						win.closeModal();
						$.get(target, function(data){
				         });
				       window.location.reload(); 
					},
					'Cancel': function(win) { win.closeModal(); }
				}
			});
	
});



$(document).on("click", "#update_parent_contact", function(event) {
	var currentTab = $("#tab-global .current").attr("id");	
	var numericity_check = numericTest();
    var phone_check = phoneValidation();
    var mobile_check = mobileValidation();
	event.preventDefault();
	var guardian_office_phone1 = $('#office1_phone'+currentTab).val();
	var ward_id = $('#current_student').val();
	var guardian_office_phone2 = $('#office2_phone'+currentTab).val();
	var guardian_mobile_phone = $('#mobile_phone'+currentTab).val();
	var data = {
				'guardian[office_phone1]' : guardian_office_phone1,
				'guardian[office_phone2]' : guardian_office_phone2,
				'guardian[mobile_phone]' : guardian_mobile_phone,
				'guardian[ward_id]' : ward_id,			  
				'parent_id' : currentTab,
				 '_method' : 'put'
	      }   	      
      if(phone_check == false){
					$('#outer_block').removeBlockMessages().blockMessage("Phone Number must be  7  - 11 Digit long", {
					type : 'warning'
				});
		  		return false;
		}
		 if(mobile_check == false){
								$('#outer_block').removeBlockMessages().blockMessage("Mobile Number must be  9  - 11 Digit long", {
								type : 'warning'
							});
					  		return false;
		}
	      if(numericity_check==false){
	      	$('#outer_block').removeBlockMessages().blockMessage('Please Enter Numeric value', {
						type : 'warning'
					});
					return false;
	      }
	var url=  "update_guardian"+ '?id='  +  ward_id
	    $.ajax({
				url : url,
				dataType : 'json',
				data : data,
				success : function(data) {
					
					if(data.valid) {
						$('#outer_block').removeBlockMessages().blockMessage(data.notice, {
							type : 'success'
						});
					} else {
						var errorText = getErrorText(data.errors);
						$('#outer_block').removeBlockMessages().blockMessage(errorText || 'An unexpected error occured, please try again', {
							type : 'error'
						});
					}
				},
				error : function(data) {
					$('#outer_block').removeBlockMessages().blockMessage('Error while contacting server, please try again', {
						type : 'error'
					});
				}
			});
});




$(document).on("click", "#update_parents", function(event) {
	var numericity_check = numericTest();
	var length_check = characterLength();
	var currentTab = $("#tab-global .current").attr("id");
	event.preventDefault();
	var guardian_first_name = $('#first_name'+currentTab).val();
	var ward_id = $('#current_student').val();
	var guardian_last_name = $('#last_name'+currentTab).val();
	var relation = $('#relation'+currentTab).val();
	var guardian_dob = $('#dob'+currentTab).val();
	var guardian_education = $('#education'+currentTab).val();
	var guardian_occupation = $('#occupation'+currentTab).val();
	var guardian_income = $('#income'+currentTab).val();
	var guardian_country = $('#guardian_country_id').val();
	var data = {
				'guardian[first_name]' : guardian_first_name,
				'guardian[last_name]' : guardian_last_name,
				'guardian[relation]' : relation,
				'guardian[dob]' : guardian_dob,
				'guardian[education]' : guardian_education,
				'guardian[occupation]' : guardian_occupation,
				'guardian[income]' : guardian_income,
				'guardian[country_id]' : guardian_country,
				'guardian[ward_id]' : ward_id,			  
				'parent_id' : currentTab,
				 '_method' : 'put'
	      }
	      if(numericity_check == false){
	      	$('#outer_block').removeBlockMessages().blockMessage('Please Enter Numeric value', {
						type : 'warning'
					});
					return false;
	      }
		  if(!guardian_first_name || guardian_first_name.length == 0) {
					$('#outer_block').removeBlockMessages().blockMessage('Please enter First name', {
						type : 'warning'
					});
					return false;
		  }
		  if(length_check == false){
					$('#outer_block').removeBlockMessages().blockMessage('You can not enter more than 50 character in field', {
						type : 'warning'
					});
					return false;
		  }
		  
		var url =  "update_guardian"+ '?id='  +  ward_id
	    $.ajax({
				url : url,
				dataType : 'json',
				data : data,
				success : function(data) {					
					if(data.valid) {
						$('#outer_block').removeBlockMessages().blockMessage(data.notice, {
							type : 'success'
						});
					} else {
						var errorText = getErrorText(data.errors);
						$('#outer_block').removeBlockMessages().blockMessage(errorText || 'An unexpected error occured, please try again', {
							type : 'error'
						});
					}
				},
				error : function(data) {
					$('#outer_block').removeBlockMessages().blockMessage('Error while contacting server, please try again', {
						type : 'error'
					});
				}
			});

});

$("#add-more-parents").on('click', function(event) {
var contents = $('#modal-box-parents');
			$.modal({
				content : contents,
				title : 'Add Guardian',
				width : 700,
				height : 400,
				buttons : {
					'Close' : function(win) {
						win.closeModal();
					},
					'Create' : function(win) {
						var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
						var numericity_check = numericTest();
						var length_check = characterLength();
						var phone_check = phoneValidation();
    					var mobile_check = mobileValidation();
						var f_name = $('#modal #parent_detail_first_name').val();
						var l_name = $('#modal #parent_detail_last_name').val();
						var relation = $('#modal #relation').val();
						var dob = $('#modal #parent_detail_dob').val();
						var education = $('#modal #parent_detail_education').val();
						var occupation = $('#modal #parent_detail_occupation').val();
						var income = $('#modal #parent_detail_income').val();
						var email = $('#modal #parent_detail_email').val();
						var add_1 = $('#modal #parent_detail_office_address_line1').val();
						var add_2 = $('#modal #parent_detail_office_address_line2').val();
						var city = $('#modal #parent_detail_city').val();
						var state = $('#modal #parent_detail_state').val();
						var off_p_1 = $('#modal #parent_detail_office_phone1').val();
						var off_p_2 = $('#modal #parent_detail_office_phone2').val();
						var country = $('#modal #parent_detail_country_id').val();
						var mob_phone = $('#modal #parent_detail_mobile_phone').val();
	                    var ward_id = $('#current_student').val();
						 if(!f_name || f_name.length == 0) {
							 $('#modal #outer_block').removeBlockMessages().blockMessage('Please Enter First Name', {
								 type : 'warning'
							 });
							 return false;
						 }
						 if(numericity_check==false){
						      	$('#modal #outer_block').removeBlockMessages().blockMessage('Please Enter Numeric value', {
											type : 'warning'
										});
								return false;
				        }
						 if(length_check == false){
								$('#modal #outer_block').removeBlockMessages().blockMessage('You can not enter more than 50 character in field', {
									type : 'warning'
								});
								return false;
						 }
						 if(phone_check == false){
							$('#modal #outer_block').removeBlockMessages().blockMessage('Phone Number must be  7  - 11 Digit long', {
								type : 'warning'
							});
					  		return false;
						}
						if(mobile_check == false){
								$('#modal #outer_block').removeBlockMessages().blockMessage("Mobile Number must be  9  - 11 Digit long", {
								type : 'warning'
							});
					  		return false;
						}
					     if(!emailReg.test(email)) {
					           	$('#modal #outer_block').removeBlockMessages().blockMessage('Please enter valid email', {
									type : 'warning'
									});		
							return false;
						 }
						 	 var target = 'add_guardian' + '?id='  +  ward_id
						 	 var data = {
								'guardian[first_name]' : f_name,
								'guardian[last_name]' : l_name,
								'guardian[relation]' : relation,
								'guardian[dob]' : dob,
								'guardian[education]' : education,
								'guardian[occupation]' : occupation,
								'guardian[income]' : income,
								'guardian[country_id]' : country,
								'guardian[email]' : email,
								'guardian[office_address_line1]' : add_1,
								'guardian[office_address_line2]' : add_2,
								'guardian[mobile_phone]' : mob_phone,
								'guardian[city]' : city,
								'guardian[state]' : state,
								'guardian[office_phone1]' : off_p_1,
								'guardian[office_phone2]' : off_p_2,
								'guardian[ward_id]' : ward_id	
							}
							
							ajaxAddGuardian(target, data, win,ward_id);
							
						 }
				}
			});
	
});

function ajaxAddGuardian(target, data, win,ward_id) {
	$.ajax({
		url : target,
		dataType : 'json',
		data : data,
		success : function(data, textStatus, jqXHR) {
			if(data.valid) {
			var href = "save"  + '?q='  +  ward_id
			$.get(href, function(data) {
			});
			window.location.reload();
				win.closeModal();			
				$('#modal #outer_block').removeBlockMessages().blockMessage(data.notice, {
					type : 'success'
				});
								
			} else {
				// Message
				var errorText = getErrorText(data.errors);
				$('#modal #outer_block').removeBlockMessages().blockMessage(errorText || 'An unexpected error occured, please try again', {
					type : 'error'
				});
				
			}
		},
		error : function(jqXHR, textStatus, errorThrown) {
			// Message
			$('#modal #outer_block').removeBlockMessages().blockMessage('Error while contacting server, please try again', {
				type : 'error'
			});
			
		}
	});

	$('#modal #outer_block').removeBlockMessages().blockMessage('Please wait, connecting to backend...', {
		type : 'loading'
	});
	
}

$("#adv_search_course_id").live('change', function(event) {

var str = "";

     $("#adv_search_course_id option:selected").each(function () {
            str = $(this).val();       
           });
            var url = 'change_batch' + '?q='  +str 
       $.get(url , function(data){
       	    $('#change_batch').empty();
            $('#change_batch').html(data);
        });
});


 $("#advv_search_course_id").live('change', function(event) {
 	$('#student_advanced_search').empty();
 	document.getElementById('student_advanced_name').value = null;
	var str = "";
     $("#advv_search_course_id option:selected").each(function () {
            str = $(this).val();       
           });
       var url = 'change_batch' + '?q='  +str 
       $.get(url , function(data){
       	    $('#change_batch').empty();
            $('#change_batch').html(data);
            $("#student_batch_id").live('change', function(event) {
            document.getElementById('student_advanced_name').value = null;
               var batch = "";
             
                    $("#student_batch_id option:selected").each(function () {
                    batch = $(this).val();       
                      });
                       var target = "student_advanced_search" + '?query=' +batch 
                $.get(target, function(data){
                	$('#student_advanced_search').empty();
                    $('#student_advanced_search').html(data);
                });
             });
       });
     
   });


$('#target').keyup(function() {
 var search = $('#target').val();
 var student_type = $('#option').val();
 var data = [search,student_type];
 var url = "search_ajax" + '?query='+data.join(',') 

 if (search.length >= 3){
	 $.get(url , function(data){		
		$('#student_search').empty();
			$('#student_search').html(data);		
	   });
	 }else{
	 	$('#student_search').empty();
	 	$('#student_search').html();
	 }
});


$('#student_advanced_name').keyup(function() {

	var search = $('#student_advanced_name').val();
	var course_id= $('#advv_search_course_id').val();
	var batch_id= $('#student_batch_id').val();
	var data = [search,course_id]
	var target = "student_advanced_search" + '?w='+data.join(',') 
	if (search.length >= 3){
		$.get(target,{batch_id: batch_id},function(data){
			$('#student_advanced_search').empty();
		    $('#student_advanced_search').html(data);
		});
	}else{
	 	$('#student_advanced_search').empty();
	 	$('#student_advanced_search').html();
	 }
}) ;

     	 	 
	
function ChangeImmidiateContact(student_id){
    var value = student_id.getAttribute('value');
    var student_id= $('#guardian_id').val();
    var contents = $('#modal-box_update');

			$.modal({
				content : contents,
				title : 'Change Immidiate Contact',
				width : 500,
				height : 100,
				buttons : {
					'Close' : function(win) {
						win.closeModal();
					},
					'Update' : function(win) {
					var radios = document.getElementsByTagName('input');
					var values;
					for (var i = 0; i < radios.length; i++) {
					    if (radios[i].type === 'radio' && radios[i].checked) {
					        values = radios[i].id;         
					    }   
					}
                          var target = "update_immediate"
					      $.get(target, {id: values,student_id: student_id }, function(data){
					       	win.closeModal();
					       	$('#myId').empty();
					       	var guardian_name=data.guardian;
					       	var guardian_number = data.guardian_number
		                    $('#myId').html('<a href="/student/guardians/" value ="" >'+guardian_name+'</a>');
						   });
						 

											       
					}
				}
			});
};
        

$(document).on("click", "#update_student_previous_detail", function(event){
	var numericity_check = numericTest();
	event.preventDefault();
	var institution_name = $('#student_previous_details_institution').val();
	var course_id= $('#student_previous_details_course').val();
    var year = $('#student_previous_details_year').val();
	var total_mark= $('#student_previous_details_total_mark').val();   
    var ward_id = $('#current_student').val();
    var target ="previous_data" + '?id='  +ward_id 
    
    var data = {
								'student_previous_data[institution]' : institution_name,
								'student_previous_data[year]' : year,
								'student_previous_data[course]' : course_id,
								'student_previous_data[total_mark]' : total_mark,
								'student_previous_data[student_id]' : ward_id	
							}
		 if(numericity_check==false){
	      	$('#outer_block').removeBlockMessages().blockMessage('Please Enter Numeric value', {
						type : 'warning'
					});
					return false;
	      }						
    
    $.ajax({
		url : target,
		dataType : 'json',
		data : data,
		success : function(data, textStatus, jqXHR) {
			if(data.valid) {		
				$('#outer_block').removeBlockMessages().blockMessage(data.notice, {
					type : 'success'
				});
								
			} else {
				// Message
				var errorText = getErrorText(data.errors);
				$('#outer_block').removeBlockMessages().blockMessage(errorText || 'An unexpected error occured, please try again', {
					type : 'error'
				});
				
			}
		},
		error : function(jqXHR, textStatus, errorThrown) {
			// Message
			$('#outer_block').removeBlockMessages().blockMessage('Error while contacting server, please try again', {
				type : 'error'
			});
			
		}
	});

	$('#outer_block').removeBlockMessages().blockMessage('Please wait, connecting to backend...', {
		type : 'loading'
	});
		
		
});

$(document).on("click", "#update_student_additional_field", function(event){
	alert("Student Additional Field is succesfully Updated");
});




$(document).ready(function() {
	$('#crop_image').Jcrop({
		onChange : update_photo_crop,
		onSelect : update_photo_crop,
		setSelect : [0, 0, 100, 100],
		aspectRatio : 1
	});
});
     
function update_photo_crop(coords) {
	var rx = 100 / coords.w;
	var ry = 100 / coords.h;
	var pw = document.getElementById("photo_width").value;
	var pwl = document.getElementById("photo_width_large").value;
	var phl = document.getElementById("photo_height_large").value;
	$('#preview').css({
		width : Math.round(rx * pwl) + 'px',
		height : Math.round(ry * phl) + 'px',
		marginLeft : '-' + Math.round(rx * coords.x) + 'px',
		marginTop : '-' + Math.round(ry * coords.y) + 'px'
	});
	var ratio = pw / pwl;
	$("#crop_x").val(Math.round(coords.x * ratio));
	$("#crop_y").val(Math.round(coords.y * ratio));
	$("#crop_w").val(Math.round(coords.w * ratio));
	$("#crop_h").val(Math.round(coords.h * ratio));
}
 

$(document).on("click", "#Crop_image", function(event){
var student_id = $('#studt_id').val();
var parent = window.opener;
			var href = "save?q=" + student_id			
			window.close();
			parent.location = href	
});


$(document).on("click", "#student_images", function(event){
	// event.preventDefault();
		var imgpath = document.getElementById('student_photo').value;
		var checkimg = imgpath.toLowerCase();
		if (!checkimg.length == 0){
			if (!checkimg.match(/(\.jpg|\.gif|\.png|\.JPG|\.GIF|\.PNG|\.jpeg|\.JPEG)$/)  )
			{
			  $('#outer_block').removeBlockMessages().blockMessage('Image Extension must be one of [.gif  or .jpg or .jpeg or .png]', {
					type : 'warning'
				});
				return false
			}else{
			    return true
			}
         }else{
         	event.preventDefault();
			window.close();		 	
         }
});


var studentchildWindow = null;
function OpenStudentChildWindow() {
	studentchildWindow = window.open('student/student_wizard_first_step','Student Admission','width=850,height=500,left=300,top=100,screenX=100,screenY=100,scrollbars=yes,location=no');
}

function StudentChildWindowStatus() {
	if(!studentchildWindow || studentchildWindow.closed){
		OpenStudentChildWindow();
	}
	else{
		studentchildWindow.focus();
	}
}
$(document).on("click", "#new_student", function(event){
		StudentChildWindowStatus();
});
