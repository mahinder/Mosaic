<div class="block-border" id="outer_block">
	<div class="block-content form">
		<h1>Attendance</h1>
		<%= form_for :advance_search ,:remote => true do |f| %>
		<fieldset>
			<legend>
				Student Report
			</legend>
			<div class="column">
				<p class="colx2-left">
					<label for="student">Student name</label>
					<%= f.text_field :student_name, :value => @student.full_name, :disabled=> true %>
				</p>
				<p class="colx2-right">
					<label for="student">Admission no.</label>
					<%= f.text_field :student_id, :value => @student.admission_no, :disabled=> true  %>
				</p>
			</div>
		</fieldset>
		<% end %>

		<% working_days = @report.size %>
		<% leaves =0 %>
		<% percentage = 0 %>
		<% table_id = [] %>

		<% @report.each do |r| %>
		<% @attendance = Attendance.find_by_student_id_and_period_table_entry_id(@student.former_id, r.id) %>
		<% unless @attendance.nil? %>
		<% table_id.push @attendance.id %>
		<% if @config.config_value == 'Daily' %>
		<% leaves += 1 %> <!-- <% leaves += 1 if @attendance.forenoon %>
		<% leaves += 1 if @attendance.afternoon %> -->
		<% else %>
		<% leaves += 1 %>
		<% end %>
		<% end %>
		<% end %>
		<br />
		<div class="column">
			<%  if @config.config_value == 'Daily' %>
			<p class="colx1-left">
				Total working days : <%= working_days %>
			</p>
			<% else %>
			<p class="colx1-left">
				Total working hours : <%= working_days %>
			</p>
			<% end %>|Total Present : <%= total = (working_days - leaves).to_f %> |
			<% percentage =  (total/working_days)*100 unless working_days == 0 %>
			Percentage : <%= percentage.round.to_f unless percentage.nil? %>
		</div>
		<% unless table_id.empty? %>
		<table class="table employees_categories" id="listing" align="center" width="100%">
			<thead>
				<tr>
					<th class="black-cell"></th>
					<th>Date</th>
					<th> Status </th>
					<th> Reason </th>
				</tr>
			</thead>
			<tbody>
				<% table_id.each do |t| %>
				<% detail_report = Attendance.find(t) %>
				<% @details = PeriodEntry.find(detail_report.period_table_entry_id) %>
				<tr>
					<td class="th table-check-cell"></td>
					<td class="col-2"><%= @details.month_date.to_date %></td>
					<td class="col-3"> <% if detail_report.forenoon and detail_report.afternoon %>
					<%= "Fullday" %>
					<% elsif detail_report.afternoon %>
					<%= "Afternoon" %>
					<% elsif detail_report.forenoon %>
					<%= "Forenoon" %>
					<% else %>
					<%= "Absent" %>
					<% end %> </td>
					<td class="col-2"> <%= detail_report.reason %></td>
					<% end %>
				</tr>
			</tbody>
		</table>
		<% end %>
	</div>
</div>