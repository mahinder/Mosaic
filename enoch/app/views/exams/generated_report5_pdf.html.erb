

	<hr style="height:0.0em;width:50em;border:1px solid #FB7A31;" />
	<h4 align="left"> <%= @batch.full_name %>/<%=@grouped_exams.grouped_exam_name%>/<%= @student.full_name %></h4>
		
		<table>
			 <tr class="yellow"> 
					 <td class="adjacent">Subject</td>
					 <td class="adjacent">Topic</td>
					<%@weight=0.0%>
					 <% @exam_groups.each do |exam_group| %>
                    			
					<% @greid =  ConnectExam.find_by_exam_group_id_and_grouped_exam_id(exam_group.id,@grouped_exams.id) %>
					<%weightage= @greid.weightage%>
				
					<%unless weightage.nil?%>
						<%@weight+=weightage%>
					 <td class="adjacent"><%= exam_group.assessment_name.name %>(<%= "%.2f" %weightage%>%)</td>
					<%else%>
					 <td class="adjacent"><%= exam_group.assessment_name.name %></td>
					<%end%>
					<% end %>
					<%unless @greid.weightage.nil?%>
					 <td class="adjacent">Subject Wise Percentage(<%="%.2f" %@weight%>%)</td>  
					 <%end%>
				</tr>
			</thead>
			<tbody>
				
				
				
				<% @subjects.each do |subject| %>
				<% subject.topics.each do |topic| %>
				
				<tr>
					<% @mmg = 1;@g = 1 %>
                      <% @sub_aggr = 0%>
                      <% @sub_aggri =0%>
                      	<% @to_obta = 0%>
						<% @to_mto = 0%>
					 <td class="adjacent"><%=subject.name%></td>
					 <td class="adjacent"><%=topic.name%></td>
					<% @exam_groups.each do |exam_group| %>
					 <%@weightage = ConnectExam.find_by_exam_group_id_and_grouped_exam_id(exam_group.id,@grouped_exams.id) %>
					<% @exam = Exam.find_by_topic_id_and_exam_group_id(topic.id,exam_group.id) %>
					<% exam_score = ExamScore.find_by_student_id(@student.id, :conditions=>{:exam_id=>@exam.id})unless @exam.nil? %>
					 <td class="adjacent"> 
						
					<% unless @exam.nil? %>
							<% if exam_group.exam_type == "MarksAndGrades" %>
								<%unless exam_score.nil?%>
								<%grade=exam_score.grading_level_detail.grading_level_detail_name unless exam_score.grading_level_detail.nil? %>
								<%unless @greid.weightage.nil?%>
									<%@obt = exam_score.marks %><%@tot = @exam.maximum_marks%>
									<% @to_obta +=@obt unless @obt.nil?%>
								     <% @to_mto +=@tot%>
										<% unless @obt.nil? or @tot.nil?%>
											<%@sub_per = @obt*100/@tot%><%unless @weightage.nil?%><%@sub_p = @sub_per* @weightage.weightage/100%><%else%><%@sub_p = 0%><%end%>
											<%@sub_aggr += @sub_p %>
										<%end%>
									<%end%>
								<%end%>
								
								<%unless @sub_p.nil?%>
								<%cal="%.2f" %(@sub_p)%>
								<%else %>
								<%cal=(@sub_p)%>
								<%end%>
								<%= exam_score.nil? ? '-' :  "#{(exam_score.marks || "Absent")}" +"/"+@exam.maximum_marks.to_s+"[#{(grade || "-")}]"+"[#{(cal || "-")}]"%>
								<% elsif exam_group.exam_type == "Marks" %>
								<%= exam_score.nil? ? '-' : "#{exam_score.marks || "-"}/"+@exam.maximum_marks.to_s %>
								<% unless exam_score.nil? %>
								<%unless @greid.weightage.nil?%>
									<%@obt = exam_score.marks %><%@tot = @exam.maximum_marks%>
									<% @to_obta +=@obt unless @obt.nil?%>
								     <% @to_mto +=@tot%>
									<% unless @obt.nil? or @tot.nil?%>
										<%@sub_per = @obt*100/@tot%><%unless @weightage.nil?%><%@sub_p = @sub_per* @weightage.weightage/100%><%else%><%@sub_p = 0%><%end%>
										<%@sub_aggr += @sub_p %>
									<%end%>
									<%end%>
								<%end%>
								<%else%>
								<%unless exam_score.nil?%>
								<%grade=exam_score.grading_level_detail.grading_level_detail_name unless exam_score.grading_level_detail.nil? %>
								<%end%>
								<%= exam_score.nil? ? '-' : (grade || '-')  %>
								<% @g = 0 %>
								<%end%>
					<% else %>
					<%= "N.A" %>
					<% end %>
							</td>
							
					<%end%>
					<%unless @greid.weightage.nil?%>
					
					<% if @mmg == @g %>  <td class="adjacent"><b>
						<%unless @sub_aggr ==0%>
						<%unless @grouped_exams.grading_level_group.nil?%>
						<%percentage_to_be_grade=@sub_aggr*100/@weight%>
						<%grade=GradingLevelDetail.percentage_to_grade(percentage_to_be_grade, @grouped_exams.grading_level_group.id)%>
						<%else%>
						<%grade="-"%>
						<%end%>
						
						<%= "%.2f" %@sub_aggr%>[<%=grade.grading_level_detail_name unless grade.nil?%>]<%else%><%unless @to_mto ==0%>
						<% @sub_aggri = @to_obta*100/@to_mto%>
						<%= "%.2f" %@sub_aggri%><%end%><%end%></b></td>
					
					<% else %>  <td class="adjacent">-</td>
					<% end %>
					<%end%>
				</tr>
			<% end %>
			<%end%>
			</tbody>
		</table>
	